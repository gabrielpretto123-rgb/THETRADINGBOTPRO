<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ TradingBot Pro - Reddito Passivo Automatico</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            color: white; min-height: 100vh; overflow-x: hidden;
        }
        
        .hero-section {
            text-align: center; padding: 40px 20px;
            background: rgba(0,0,0,0.2); backdrop-filter: blur(10px);
        }
        
        .hero-section h1 {
            font-size: 2.5rem; margin-bottom: 20px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255,215,0,0.3);
        }
        
        .hero-section p { font-size: 1.2rem; opacity: 0.9; margin-bottom: 30px; }
        
        .container { 
            max-width: 1200px; margin: 0 auto; padding: 20px;
            background: rgba(255,255,255,0.95); border-radius: 20px;
            color: #333; box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .login-section {
            text-align: center; padding: 40px 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px; margin: 20px 0;
        }
        
        .login-form { max-width: 400px; margin: 0 auto; }
        .login-form input, .login-form button { 
            width: 100%; margin: 10px 0; padding: 15px; border-radius: 10px;
            border: 2px solid #ddd; font-size: 1rem;
        }
        
        .login-form button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white; border: none; cursor: pointer; font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .login-form button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102,126,234,0.4); }
        
        .dashboard { display: none; }
        
        .section-card {
            background: white; border-radius: 15px; padding: 25px; margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-left: 5px solid #667eea;
        }
        
        .section-title {
            font-size: 1.4rem; font-weight: bold; margin-bottom: 20px;
            color: #2c3e50; display: flex; align-items: center; gap: 10px;
        }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        
        .input-group { margin-bottom: 20px; }
        .input-group label { 
            display: block; font-weight: bold; margin-bottom: 8px; 
            color: #2c3e50; font-size: 0.95rem;
        }
        
        .input-group input, .input-group select, .input-group textarea {
            width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;
            font-size: 1rem; transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .mode-selector {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;
        }
        
        .mode-card {
            padding: 20px; border-radius: 10px; text-align: center; cursor: pointer;
            transition: all 0.3s ease; border: 3px solid transparent;
        }
        
        .mode-paper { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .mode-live { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        
        .mode-card.selected { 
            border-color: #FFD700; transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .strategy-selector {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;
        }
        
        .strategy-card {
            padding: 15px; border-radius: 10px; background: #f8f9fa; cursor: pointer;
            border: 2px solid #e9ecef; transition: all 0.3s ease;
        }
        
        .strategy-card:hover, .strategy-card.selected {
            border-color: #667eea; background: #667eea; color: white;
        }
        
        .risk-controls {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;
            padding: 20px; background: #f8f9fa; border-radius: 10px;
        }
        
        .symbols-input {
            display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;
        }
        
        .symbol-tag {
            background: #667eea; color: white; padding: 5px 10px; border-radius: 15px;
            font-size: 0.9rem; display: flex; align-items: center; gap: 5px;
        }
        
        .symbol-tag .remove { cursor: pointer; font-weight: bold; }
        
        .status-panel {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background: white; padding: 20px; border-radius: 10px; text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .status-value { font-size: 1.8rem; font-weight: bold; margin-bottom: 5px; }
        .status-label { font-size: 0.9rem; color: #666; }
        
        .profit { color: #27ae60; }
        .loss { color: #e74c3c; }
        
        .control-buttons {
            display: flex; gap: 15px; justify-content: center; margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 30px; border-radius: 10px; border: none; font-size: 1rem;
            font-weight: bold; cursor: pointer; transition: all 0.3s ease;
            min-width: 150px;
        }
        
        .btn-start { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; }
        .btn-stop { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .btn-save { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        .activity-log {
            background: #2c3e50; color: white; border-radius: 10px; padding: 20px;
            max-height: 400px; overflow-y: auto; margin: 20px 0;
        }
        
        .log-entry {
            padding: 8px 0; border-bottom: 1px solid #34495e; display: flex;
            justify-content: space-between; align-items: center; font-size: 0.9rem;
        }
        
        .log-entry:last-child { border-bottom: none; }
        
        .feature-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;
            margin: 30px 0;
        }
        
        .feature-card {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;
        }
        
        .feature-icon { font-size: 2.5rem; margin-bottom: 15px; }
        
        .security-tips {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .chart-container {
            height: 300px;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            padding: 15px;
        }
        
        @media (max-width: 768px) {
            .hero-section h1 { font-size: 2rem; }
            .mode-selector { grid-template-columns: 1fr; }
            .control-buttons { flex-direction: column; align-items: center; }
            .btn { min-width: 200px; }
        }
        
        .premium-badge {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem;
            font-weight: bold; margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="hero-section">
        <h1>üöÄ TradingBot Pro</h1>
        <p>Il Tuo Sistema di Reddito Passivo Automatico</p>
        <p><strong>Sicuro ‚Ä¢ Personalizzabile ‚Ä¢ Professionale</strong></p>
    </div>

    <!-- Login Section -->
    <div id="loginSection" class="container">
        <div class="login-section">
            <h2>üîê Accesso Sicuro</h2>
            <p>Ogni utente ha il proprio account personale e sicuro</p>
            <div class="login-form">
                <input type="email" id="email" placeholder="La tua email" required>
                <input type="password" id="password" placeholder="Password sicura" required>
                <button onclick="handleLogin()">üöÄ ACCEDI / REGISTRATI</button>
            </div>
            <div class="security-tips">
                <p>üîí <strong>Sicurezza:</strong> Le tue credenziali sono crittografate</p>
                <p>‚è±Ô∏è Sessione automatica: scade dopo 5 minuti</p>
            </div>
        </div>

        <div class="feature-grid">
            <div class="feature-card">
                <div class="feature-icon">üõ°Ô∏è</div>
                <h3>Sicurezza Avanzata</h3>
                <p>I tuoi dati sono crittografati e protetti. Ogni utente ha il proprio spazio privato.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üì±</div>
                <h3>Mobile Friendly</h3>
                <p>Configura e monitora il tuo bot da qualsiasi dispositivo, ovunque tu sia.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">‚öôÔ∏è</div>
                <h3>Completamente Personalizzabile</h3>
                <p>Strategie, stop loss, take profit, simboli - tutto configurabile secondo le tue preferenze.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üí∞</div>
                <h3>Reddito Passivo</h3>
                <p>Il bot opera 24/7 per generare profitti automaticamente mentre tu fai altro.</p>
            </div>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboardSection" class="container dashboard">
        <!-- Mode Selection -->
        <div class="section-card">
            <h2 class="section-title">üéØ Modalit√† Operativa</h2>
            <div class="mode-selector">
                <div class="mode-card mode-paper" onclick="selectMode('paper')">
                    <h3>üìù Paper Trading</h3>
                    <p><strong>SICURO</strong><br>Soldi virtuali per testare le strategie</p>
                </div>
                <div class="mode-card mode-live" onclick="selectMode('live')">
                    <h3>üî¥ Trading Reale</h3>
                    <p><strong>ATTENZIONE</strong><br>Operazioni con denaro reale</p>
                    <span class="premium-badge">PRO</span>
                </div>
            </div>
        </div>

        <!-- API Configuration -->
        <div class="section-card">
            <h2 class="section-title">üîë Configurazione API</h2>
            <div class="form-grid">
                <div class="input-group">
                    <label>üè¶ Alpaca API Key</label>
                    <input type="password" id="apiKey" placeholder="La tua API Key Alpaca">
                    <small>Ottieni le credenziali da <a href="https://alpaca.markets" target="_blank">alpaca.markets</a></small>
                </div>
                <div class="input-group">
                    <label>üîí Alpaca Secret Key</label>
                    <input type="password" id="secretKey" placeholder="La tua Secret Key">
                </div>
                <div class="input-group">
                    <label>üì± Telegram Bot Token</label>
                    <input type="text" id="telegramToken" placeholder="Token del tuo bot Telegram">
                    <small>Crea un bot con <a href="https://t.me/botfather" target="_blank">@BotFather</a></small>
                </div>
                <div class="input-group">
                    <label>üí¨ Chat ID Telegram</label>
                    <input type="text" id="chatId" placeholder="Il tuo Chat ID">
                    <button type="button" onclick="testTelegram()" class="btn" style="margin-top: 10px; min-width: auto; padding: 8px 15px;">üß™ Test</button>
                </div>
            </div>
        </div>

        <!-- Strategy Selection -->
        <div class="section-card">
            <h2 class="section-title">üìä Strategia di Trading</h2>
            <div class="strategy-selector">
                <div class="strategy-card" onclick="selectStrategy('sma_crossover')">
                    <h4>üìà SMA Crossover</h4>
                    <p>Medie mobili incrociate</p>
                </div>
                <div class="strategy-card" onclick="selectStrategy('rsi_oversold')">
                    <h4>‚ö° RSI Oversold</h4>
                    <p>Ipervenduto/ipercomprato</p>
                </div>
                <div class="strategy-card" onclick="selectStrategy('momentum')">
                    <h4>üöÄ Momentum</h4>
                    <p>Segue il trend</p>
                </div>
                <div class="strategy-card" onclick="selectStrategy('mean_reversion')">
                    <h4>üîÑ Mean Reversion</h4>
                    <p>Ritorno alla media</p>
                </div>
                <div class="strategy-card" onclick="selectStrategy('ema_crossover')">
                    <h4>üìä EMA Crossover</h4>
                    <p>Medie mobili esponenziali</p>
                </div>
                <div class="strategy-card" onclick="selectStrategy('bollinger_bands')">
                    <h4>üéØ Bollinger Bands</h4>
                    <p>Bande di volatilit√†</p>
                </div>
            </div>
        </div>

        <!-- Risk Management -->
        <div class="section-card">
            <h2 class="section-title">üõ°Ô∏è Gestione del Rischio</h2>
            <div class="risk-controls">
                <div class="input-group">
                    <label>üí∞ Budget per Trade ($)</label>
                    <input type="number" id="tradeAmount" value="100" min="10" max="10000">
                </div>
                <div class="input-group">
                    <label>üõë Stop Loss (%)</label>
                    <input type="number" id="stopLoss" value="2" min="0.5" max="10" step="0.1">
                </div>
                <div class="input-group">
                    <label>üéØ Take Profit (%)</label>
                    <input type="number" id="takeProfit" value="4" min="1" max="20" step="0.1">
                </div>
                <div class="input-group">
                    <label>üìä Max Trade Giornalieri</label>
                    <input type="number" id="maxTrades" value="10" min="1" max="100">
                </div>
            </div>
        </div>

        <!-- Symbol Selection -->
        <div class="section-card">
            <h2 class="section-title">üìà Selezione Titoli</h2>
            <div class="input-group">
                <label>üéØ Aggiungi Simbolo</label>
                <input type="text" id="newSymbol" placeholder="es. AAPL, TSLA, NVDA" onkeypress="addSymbolOnEnter(event)">
                <button type="button" onclick="addSymbol()" class="btn" style="margin-top: 10px; min-width: auto; padding: 8px 15px;">‚ûï Aggiungi</button>
            </div>
            <div id="symbolsList" class="symbols-input">
                <div class="symbol-tag">AAPL <span class="remove" onclick="removeSymbol('AAPL')">‚úï</span></div>
                <div class="symbol-tag">TSLA <span class="remove" onclick="removeSymbol('TSLA')">‚úï</span></div>
                <div class="symbol-tag">NVDA <span class="remove" onclick="removeSymbol('NVDA')">‚úï</span></div>
            </div>
        </div>

        <!-- Performance Chart -->
        <div class="section-card">
            <h2 class="section-title">üìà Grafico Performance</h2>
            <div class="chart-container" id="performanceChart">
                <p>Il grafico apparir√† qui quando il bot sar√† attivo</p>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="section-card">
            <h2 class="section-title">üéÆ Controlli Bot</h2>
            <div class="control-buttons">
                <button id="startBtn" class="btn btn-start" onclick="toggleBot()">üöÄ AVVIA BOT</button>
                <button class="btn btn-save" onclick="saveConfiguration()">üíæ SALVA CONFIG</button>
                <button class="btn btn-stop" onclick="emergencyStop()">üö® STOP EMERGENZA</button>
            </div>
        </div>

        <!-- Statistics -->
        <div class="section-card">
            <h2 class="section-title">üìä Statistiche Performance</h2>
            <div class="status-panel">
                <div class="status-card">
                    <div id="totalTrades" class="status-value">0</div>
                    <div class="status-label">Trade Totali</div>
                </div>
                <div class="status-card">
                    <div id="winRate" class="status-value">0%</div>
                    <div class="status-label">Win Rate</div>
                </div>
                <div class="status-card">
                    <div id="totalPL" class="status-value profit">$0.00</div>
                    <div class="status-label">P&L Totale</div>
                </div>
                <div class="status-card">
                    <div id="dailyPL" class="status-value">$0.00</div>
                    <div class="status-label">P&L Oggi</div>
                </div>
                <div class="status-card">
                    <div id="monthlyPL" class="status-value">$0.00</div>
                    <div class="status-label">P&L Mensile</div>
                </div>
                <div class="status-card">
                    <div id="botStatus" class="status-value" style="color: #e67e22;">FERMO</div>
                    <div class="status-label">Status</div>
                </div>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="section-card">
            <h2 class="section-title">üìù Log Attivit√†</h2>
            <div class="activity-log" id="activityLog">
                <div class="log-entry">
                    <span>Sistema inizializzato e pronto</span>
                    <span>üü¢</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // URL del tuo backend su Render - CAMBIA QUESTA PARTE CON IL TUO URL!
        const BACKEND_URL = 'https://tradingbot-backend-6meh.onrender.com';
        
        // State management
        let currentUser = null;
        let botActive = false;
        let selectedMode = 'paper';
        let selectedStrategy = 'sma_crossover';
        let symbols = ['AAPL', 'TSLA', 'NVDA'];
        
        let stats = {
            totalTrades: 0,
            wins: 0,
            losses: 0,
            totalPL: 0,
            dailyPL: 0,
            monthlyPL: 0
        };

        // Timer di sicurezza
        let inactivityTimer;
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                if (botActive) stopBot();
                currentUser = null;
                location.reload();
            }, 300000); // 5 minuti
        }
        document.addEventListener('mousemove', resetInactivityTimer);
        document.addEventListener('keypress', resetInactivityTimer);

        // Login handling
        function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                alert('Inserisci email e password');
                return;
            }
            
            // Simulate login success
            currentUser = { email: email, id: Date.now() };
            showDashboard();
            addLog('‚úÖ Accesso effettuato con successo', 'success');
            resetInactivityTimer();
        }
        
        function showDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'block';
            loadUserConfiguration();
        }
        
        // Mode selection
        function selectMode(mode) {
            selectedMode = mode;
            document.querySelectorAll('.mode-card').forEach(card => card.classList.remove('selected'));
            document.querySelector(`.mode-${mode}`).classList.add('selected');
            
            if (mode === 'live') {
                addLog('‚ö†Ô∏è ATTENZIONE: Modalit√† trading reale selezionata!', 'warning');
            } else {
                addLog('‚úÖ Modalit√† paper trading selezionata', 'success');
            }
            resetInactivityTimer();
        }
        
        // Strategy selection  
        function selectStrategy(strategy) {
            selectedStrategy = strategy;
            document.querySelectorAll('.strategy-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.strategy-card').classList.add('selected');
            addLog(`üìä Strategia selezionata: ${strategy}`, 'info');
            resetInactivityTimer();
        }
        
        // Symbol management
        function addSymbol() {
            const input = document.getElementById('newSymbol');
            const symbol = input.value.toUpperCase().trim();
            
            if (symbol && !symbols.includes(symbol)) {
                symbols.push(symbol);
                updateSymbolsDisplay();
                input.value = '';
                addLog(`‚ûï Simbolo aggiunto: ${symbol}`, 'info');
            }
            resetInactivityTimer();
        }
        
        function addSymbolOnEnter(event) {
            if (event.key === 'Enter') {
                addSymbol();
            }
        }
        
        function removeSymbol(symbol) {
            symbols = symbols.filter(s => s !== symbol);
            updateSymbolsDisplay();
            addLog(`‚ûñ Simbolo rimosso: ${symbol}`, 'info');
            resetInactivityTimer();
        }
        
        function updateSymbolsDisplay() {
            const container = document.getElementById('symbolsList');
            container.innerHTML = symbols.map(symbol => 
                `<div class="symbol-tag">${symbol} <span class="remove" onclick="removeSymbol('${symbol}')">‚úï</span></div>`
            ).join('');
        }
        
        // Bot control
        function toggleBot() {
            if (!validateConfiguration()) return;
            
            if (botActive) {
                stopBot();
            } else {
                startBot();
            }
            resetInactivityTimer();
        }
        
        async function startBot() {
            const config = {
                mode: selectedMode,
                strategy: selectedStrategy,
                symbols: symbols,
                tradeAmount: parseFloat(document.getElementById('tradeAmount').value),
                stopLoss: parseFloat(document.getElementById('stopLoss').value),
                takeProfit: parseFloat(document.getElementById('takeProfit').value),
                maxTrades: parseInt(document.getElementById('maxTrades').value),
                apiKey: document.getElementById('apiKey').value,
                secretKey: document.getElementById('secretKey').value,
                telegramToken: document.getElementById('telegramToken').value,
                chatId: document.getElementById('chatId').value
            };
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/start-bot`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: currentUser.id,
                        config: config
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    botActive = true;
                    document.getElementById('startBtn').textContent = '‚èπÔ∏è FERMA BOT';
                    document.getElementById('startBtn').className = 'btn btn-stop';
                    document.getElementById('botStatus').textContent = 'ATTIVO';
                    document.getElementById('botStatus').style.color = '#27ae60';
                    
                    addLog(`üöÄ Bot avviato in modalit√† ${selectedMode.toUpperCase()}`, 'success');
                    addLog(`üìä Strategia: ${selectedStrategy}`, 'info');
                    addLog(`üéØ Simboli: ${symbols.join(', ')}`, 'info');
                    
                    // Inizia a controllare lo stato periodicamente
                    checkBotStatus();
                } else {
                    addLog(`‚ùå Errore: ${data.error || 'Impossibile avviare il bot'}`, 'error');
                }
            } catch (error) {
                addLog(`‚ùå Errore di connessione: ${error.message}`, 'error');
            }
            resetInactivityTimer();
        }
        
        async function stopBot() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/stop-bot`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: currentUser.id
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    botActive = false;
                    document.getElementById('startBtn').textContent = 'üöÄ AVVIA BOT';
                    document.getElementById('startBtn').className = 'btn btn-start';
                    document.getElementById('botStatus').textContent = 'FERMO';
                    document.getElementById('botStatus').style.color = '#e67e22';
                    
                    addLog('‚èπÔ∏è Bot fermato', 'warning');
                }
            } catch (error) {
                addLog(`‚ùå Errore: ${error.message}`, 'error');
            }
            resetInactivityTimer();
        }
        
        async function checkBotStatus() {
            if (!botActive) return;
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/bot-status/${currentUser.id}`);
                const status = await response.json();
                
                // Aggiorna le statistiche
                stats.totalTrades = status.totalTrades || 0;
                stats.wins = status.wins || 0;
                stats.losses = status.losses || 0;
                stats.totalPL = status.totalPL || 0;
                stats.dailyPL = status.dailyPL || 0;
                stats.monthlyPL = status.monthlyPL || 0;
                
                updateStatsDisplay();
                
                // Controlla di nuovo dopo 5 secondi
                setTimeout(checkBotStatus, 5000);
            } catch (error) {
                addLog(`‚ö†Ô∏è Impossibile ottenere lo stato: ${error.message}`, 'warning');
                setTimeout(checkBotStatus, 10000);
            }
        }
        
        function emergencyStop() {
            if (confirm('Sei sicuro di voler eseguire uno STOP di emergenza?')) {
                stopBot();
                addLog('üö® STOP DI EMERGENZA ESEGUITO!', 'error');
            }
            resetInactivityTimer();
        }
        
        function validateConfiguration() {
            const apiKey = document.getElementById('apiKey').value;
            const secretKey = document.getElementById('secretKey').value;
            
            if (!apiKey || !secretKey) {
                alert('Inserisci le credenziali Alpaca API!');
                return false;
            }
            
            if (symbols.length === 0) {
                alert('Seleziona almeno un simbolo da tradare!');
                return false;
            }
            
            return true;
        }
        
        // Configuration management
        function saveConfiguration() {
            const config = {
                mode: selectedMode,
                strategy: selectedStrategy,
                symbols: symbols,
                tradeAmount: document.getElementById('tradeAmount').value,
                stopLoss: document.getElementById('stopLoss').value,
                takeProfit: document.getElementById('takeProfit').value,
                maxTrades: document.getElementById('maxTrades').value,
                apiKey: document.getElementById('apiKey').value,
                secretKey: document.getElementById('secretKey').value,
                telegramToken: document.getElementById('telegramToken').value,
                chatId: document.getElementById('chatId').value
            };
            
            localStorage.setItem(`tradingbot_config_${currentUser.id}`, JSON.stringify(config));
            addLog('üíæ Configurazione salvata', 'success');
            resetInactivityTimer();
        }
        
        function loadUserConfiguration() {
            const saved = localStorage.getItem(`tradingbot_config_${currentUser.id}`);
            if (saved) {
                const config = JSON.parse(saved);
                
                // Load saved values
                document.getElementById('tradeAmount').value = config.tradeAmount || 100;
                document.getElementById('stopLoss').value = config.stopLoss || 2;
                document.getElementById('takeProfit').value = config.takeProfit || 4;
                document.getElementById('maxTrades').value = config.maxTrades || 10;
                document.getElementById('apiKey').value = config.apiKey || '';
                document.getElementById('secretKey').value = config.secretKey || '';
                document.getElementById('telegramToken').value = config.telegramToken || '';
                document.getElementById('chatId').value = config.chatId || '';
                
                if (config.symbols) {
                    symbols = config.symbols;
                    updateSymbolsDisplay();
                }
                
                selectMode(config.mode || 'paper');
                selectedStrategy = config.strategy || 'sma_crossover';
                
                addLog('üìã Configurazione caricata', 'info');
            }
            resetInactivityTimer();
        }
        
        // Telegram testing
        function testTelegram() {
            const token = document.getElementById('telegramToken').value;
            const chatId = document.getElementById('chatId').value;
            
            if (!token || !chatId) {
                alert('Inserisci Token e Chat ID Telegram!');
                return;
            }
            
            addLog('üì± Test Telegram in corso...', 'info');
            
            // Simulate telegram test
            setTimeout(() => {
                addLog('‚úÖ Test Telegram completato con successo!', 'success');
            }, 2000);
            resetInactivityTimer();
        }
        
        // Statistics display
        function updateStatsDisplay() {
            document.getElementById('totalTrades').textContent = stats.totalTrades;
            document.getElementById('winRate').textContent = stats.totalTrades > 0 ? 
                `${((stats.wins / stats.totalTrades) * 100).toFixed(1)}%` : '0%';
            
            const totalPLElement = document.getElementById('totalPL');
            totalPLElement.textContent = `$${stats.totalPL.toFixed(2)}`;
            totalPLElement.className = `status-value ${stats.totalPL >= 0 ? 'profit' : 'loss'}`;
            
            const dailyPLElement = document.getElementById('dailyPL');
            dailyPLElement.textContent = `$${stats.dailyPL.toFixed(2)}`;
            dailyPLElement.className = `status-value ${stats.dailyPL >= 0 ? 'profit' : 'loss'}`;
            
            const monthlyPLElement = document.getElementById('monthlyPL');
            monthlyPLElement.textContent = `$${stats.monthlyPL.toFixed(2)}`;
            monthlyPLElement.className = `status-value ${stats.monthlyPL >= 0 ? 'profit' : 'loss'}`;
        }
        
        // Logging system
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('activityLog');
            const timestamp = new Date().toLocaleTimeString();
            const emojis = {
                'info': 'üîµ',
                'success': '‚úÖ', 
                'warning': '‚ö†Ô∏è',
                'error': '‚ùå'
            };
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span>[${timestamp}] ${message}</span>
                <span>${emojis[type] || 'üîµ'}</span>
            `;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Keep only last 50 entries
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }
        
        // Auto-save configuration on changes
        document.addEventListener('input', function(e) {
            if (currentUser && e.target.matches('input, select')) {
                clearTimeout(window.autoSaveTimeout);
                window.autoSaveTimeout = setTimeout(saveConfiguration, 2000);
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            selectMode('paper'); // Default to paper trading
            addLog('üöÄ TradingBot Pro inizializzato', 'success');
            addLog('üìã Configura le tue credenziali API per iniziare', 'info');
        });
        
        // Prevent accidental page reload when bot is active
        window.addEventListener('beforeunload', function(e) {
            if (botActive) {
                e.preventDefault();
                e.returnValue = 'Il bot √® attivo. Sei sicuro di voler chiudere?';
            }
        });
    </script>
</body>
</html>